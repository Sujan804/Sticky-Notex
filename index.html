<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css"
        integrity="sha256-ECB9bbROLGm8wOoEbHcHRxlHgzGqYpDtNTgDTyDz0wg=" crossorigin="anonymous" />
    <title>Sticky Task</title>
</head>

<body>
    <div class="container">
        <h4>Sticky Task</h4>
        <hr />
        <form id="task_form">
            <input type="text" id="new_task" placeholder="New Task">
            <input type="submit" value="Add Task">
        </form>
        <hr>
        <h4>Tasks</h4>
        <input type="text" id="task_filter" placeholder="Filter Task">
        <ul id="tasks">

        </ul>
        <button id="clear_task_btn">Clear Tasks</button>
    </div>

    <script>
        let form = document.querySelector('#task_form');
        let taskList = document.querySelector('ul');
        let clearBtn = document.querySelector('#clear_task_btn');
        let filter = document.querySelector('#task_filter');
        let taskInput = document.querySelector('#new_task');

        form.addEventListener('submit', addTask);
        taskList.addEventListener('click', removeTask);
        clearBtn.addEventListener('click', clearTask);
        filter.addEventListener('keyup', filterTask);
        document.addEventListener('DOMContentLoaded', getTasks);

        function addTask(e) {
            if (taskInput.value === '') {
                alert('Add a task!');
            } else {
                // Create li element
                let li = document.createElement('li');
                li.appendChild(document.createTextNode(taskInput.value + " "));
                let link = document.createElement('a');
                link.setAttribute('href', '#');
                link.innerHTML = 'x';
                li.appendChild(link);
                taskList.appendChild(li);
                storeTaskInLocalStorage(taskInput.value);

            }
            taskInput.value = '';
            e.preventDefault();
        }
        // Remove Task

        function removeTask(e) {
            if (e.target.hasAttribute("href")) {
                if (confirm("Are your sure?")) {
                    let ele = e.target.parentElement;
                    ele.remove();
                }
            }
        }

        //Clear task
        function clearTask(e) {
            while (taskList.firstChild) {
                taskList.removeChild(taskList.firstChild);
            }
            localStorage.clear();
        }

        function filterTask(e) {
            let text = e.target.value.toLowerCase();

            document.querySelectorAll('li').forEach(task => {
                let item = task.firstChild.textContent;
                if (item.toLowerCase().indexOf(text) != -1) {
                    task.style.display = 'block';
                } else {
                    task.style.display = 'none';
                }
            });
        }

        function getTasks() {
            let tasks;
            if (localStorage.getItem('tasks') === null) {
                tasks = [];
            } else {
                tasks = JSON.parse(localStorage.getItem('tasks'));
            }

            tasks.forEach(task => {
                let li = document.createElement('li');
                li.appendChild(document.createTextNode(task + " "));
                let link = document.createElement('a');
                link.setAttribute('href', '#');
                link.innerHTML = 'x';
                li.appendChild(link);
                taskList.appendChild(li);
            });
        }

        function removeFromLS(taskItem) {
            let tasks;
            if (localStorage.getItem('tasks') === null) {
                tasks = [];
            } else {
                tasks = JSON.parse(localStorage.getItem('tasks'));
            }

            let li = taskItem;
            li.removeChild(li.lastChild); // <a>x</a>'

            tasks.forEach((task, index) => {
                if (li.textContent.trim() === task) {
                    tasks.splice(index, 1);
                }
            });

            localStorage.setItem('tasks', JSON.stringify(tasks));
        }
    </script>
</body>

</html>